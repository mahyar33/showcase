<!DOCTYPE html>

<html>
<head>
  <title>serviceWorker.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="..\docco.css" />
</head>
<body>
  <div class="container">
    
      <div class="toc">
        <h3>Table of Contents</h3>
        <ul>
          
          
          
            
            
            
            
            <li class="indent0">
              <a class="source" href="..\README.html">
                README.md
              </a>
            </li>
          
            
            
            
              
              
                
                  <h4 class="indent0">misc/</h4>
                
              
                
                  <h4 class="indent1">tutorials/</h4>
                
              
              
            
            
            <li class="indent2">
              <a class="source" href="..\misc\tutorials\networkInstallation.html">
                networkInstallation.md
              </a>
            </li>
          
            
            
            
              
              
                
                  <h4 class="indent0">src/</h4>
                
              
              
            
            
            <li class="indent1">
              <a class="source" href="App.html">
                App.js
              </a>
            </li>
          
            
            
            
            
            <li class="indent1">
              <a class="source" href="App.test.html">
                App.test.js
              </a>
            </li>
          
            
            
            
            
            <li class="indent1">
              <a class="source" href="index.html">
                index.js
              </a>
            </li>
          
            
            
            
              
              
                
              
                
                  <h4 class="indent1">network/</h4>
                
              
              
            
            
            <li class="indent2">
              <a class="source" href="network\HttpRequest.html">
                HttpRequest.js
              </a>
            </li>
          
            
            
            
            
            <li class="indent2">
              <a class="source" href="network\SocketConnection.html">
                SocketConnection.js
              </a>
            </li>
          
            
            
            
              
              
                
              
                
                  <h4 class="indent1">routes/</h4>
                
              
              
            
            
            <li class="indent2">
              <a class="source" href="routes\PrivateRoute.html">
                PrivateRoute.js
              </a>
            </li>
          
            
            
            
            
            <li class="indent2">
              <a class="source" href="routes\PublicRoute.html">
                PublicRoute.js
              </a>
            </li>
          
            
            
            
            
            <li class="indent2">
              <a class="source" href="routes\RedirectIndex.html">
                RedirectIndex.js
              </a>
            </li>
          
            
            
            
            
            <li class="indent2">
              <a class="source" href="routes\Routes.html">
                Routes.js
              </a>
            </li>
          
            
            
            
            
            <li class="indent2">
              <a class="source" href="routes\authorizedRoutes.html">
                authorizedRoutes.js
              </a>
            </li>
          
            
            
            
              
              
                
              
              
            
            
            <li class="indent1">
              <a class="source" href="serviceWorker.html">
                serviceWorker.js
              </a>
            </li>
          
            
            
            
              
              
                
              
                
                  <h4 class="indent1">utils/</h4>
                
              
              
            
            
            <li class="indent2">
              <a class="source" href="utils\CompoundIntl.html">
                CompoundIntl.js
              </a>
            </li>
          
            
            
            
            
            <li class="indent2">
              <a class="source" href="utils\Security.html">
                Security.js
              </a>
            </li>
          
        </ul>
      </div>
    
    <div class="page">
      <div class="header">
        
          <h1>serviceWorker.js</h1>
        
      </div>

      
        
        <p>This optional code is used to register a service worker.
register() is not called by default.</p>

        
      
        
        <p>This lets the app load faster on subsequent visits in production, and gives
it offline capabilities. However, it also means that developers (and users)
will only see deployed updates on subsequent visits to a page, after all the
existing tabs open on the page have been closed, since previously cached
resources are updated in the background.</p>

        
      
        
        <p>To learn more about the benefits of this model and instructions on how to
opt-in, read <a href="https://bit.ly/CRA-PWA">https://bit.ly/CRA-PWA</a></p>

        
          <div class='highlight'><pre>
<span class="hljs-keyword">const</span> isLocalhost = <span class="hljs-built_in">Boolean</span>(
  <span class="hljs-built_in">window</span>.location.hostname === <span class="hljs-string">'localhost'</span> ||</pre></div>
        
      
        
        <p>[::1] is the IPv6 localhost address.</p>

        
          <div class='highlight'><pre>    <span class="hljs-built_in">window</span>.location.hostname === <span class="hljs-string">'[::1]'</span> ||</pre></div>
        
      
        
        <p>127.0.0.1/8 is considered localhost for IPv4.</p>

        
          <div class='highlight'><pre>    <span class="hljs-built_in">window</span>.location.hostname.match(
      <span class="hljs-regexp">/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/</span>
    )
);

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params">config</span>) </span>{
  <span class="hljs-keyword">if</span> (process.env.NODE_ENV === <span class="hljs-string">'production'</span> &amp;&amp; <span class="hljs-string">'serviceWorker'</span> <span class="hljs-keyword">in</span> navigator) {</pre></div>
        
      
        
        <p>The URL constructor is available in all browsers that support SW.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">const</span> publicUrl = <span class="hljs-keyword">new</span> URL(process.env.PUBLIC_URL, <span class="hljs-built_in">window</span>.location.href);
    <span class="hljs-keyword">if</span> (publicUrl.origin !== <span class="hljs-built_in">window</span>.location.origin) {</pre></div>
        
      
        
        <p>Our service worker won’t work if PUBLIC_URL is on a different origin
from what our page is served on. This might happen if a CDN is used to
serve assets; see <a href="https://github.com/facebook/create-react-app/issues/2374">https://github.com/facebook/create-react-app/issues/2374</a></p>

        
          <div class='highlight'><pre>      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'load'</span>, () =&gt; {
      <span class="hljs-keyword">const</span> swUrl = <span class="hljs-string">`<span class="hljs-subst">${process.env.PUBLIC_URL}</span>/service-worker.js`</span>;

      <span class="hljs-keyword">if</span> (isLocalhost) {</pre></div>
        
      
        
        <p>This is running on localhost. Let’s check if a service worker still exists or not.</p>

        
          <div class='highlight'><pre>        checkValidServiceWorker(swUrl, config);</pre></div>
        
      
        
        <p>Add some additional logging to localhost, pointing developers to the
service worker/PWA documentation.</p>

        
          <div class='highlight'><pre>        navigator.serviceWorker.ready.then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
          <span class="hljs-built_in">console</span>.log(
            <span class="hljs-string">'This web app is being served cache-first by a service '</span> +
              <span class="hljs-string">'worker. To learn more, visit https://bit.ly/CRA-PWA'</span>
          );
        });
      } <span class="hljs-keyword">else</span> {</pre></div>
        
      
        
        <p>Is not localhost. Just register service worker</p>

        
          <div class='highlight'><pre>        registerValidSW(swUrl, config);
      }
    });
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">registerValidSW</span>(<span class="hljs-params">swUrl, config</span>) </span>{
  navigator.serviceWorker
    .register(swUrl)
    .then(<span class="hljs-function"><span class="hljs-params">registration</span> =&gt;</span> {
      registration.onupdatefound = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> installingWorker = registration.installing;
        <span class="hljs-keyword">if</span> (installingWorker == <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span>;
        }
        installingWorker.onstatechange = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
          <span class="hljs-keyword">if</span> (installingWorker.state === <span class="hljs-string">'installed'</span>) {
            <span class="hljs-keyword">if</span> (navigator.serviceWorker.controller) {</pre></div>
        
      
        
        <p>At this point, the updated precached content has been fetched,
but the previous service worker will still serve the older
content until all client tabs are closed.</p>

        
          <div class='highlight'><pre>              <span class="hljs-built_in">console</span>.log(
                <span class="hljs-string">'New content is available and will be used when all '</span> +
                  <span class="hljs-string">'tabs for this page are closed. See https://bit.ly/CRA-PWA.'</span>
              );</pre></div>
        
      
        
        <p>Execute callback</p>

        
          <div class='highlight'><pre>              <span class="hljs-keyword">if</span> (config &amp;&amp; config.onUpdate) {
                config.onUpdate(registration);
              }
            } <span class="hljs-keyword">else</span> {</pre></div>
        
      
        
        <p>At this point, everything has been precached.
It’s the perfect time to display a
“Content is cached for offline use.” message.</p>

        
          <div class='highlight'><pre>              <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Content is cached for offline use.'</span>);</pre></div>
        
      
        
        <p>Execute callback</p>

        
          <div class='highlight'><pre>              <span class="hljs-keyword">if</span> (config &amp;&amp; config.onSuccess) {
                config.onSuccess(registration);
              }
            }
          }
        };
      };
    })
    .catch(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Error during service worker registration:'</span>, error);
    });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkValidServiceWorker</span>(<span class="hljs-params">swUrl, config</span>) </span>{</pre></div>
        
      
        
        <p>Check if the service worker can be found. If it can’t reload the page.</p>

        
          <div class='highlight'><pre>  fetch(swUrl)
    .then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {</pre></div>
        
      
        
        <p>Ensure service worker exists, and that we really are getting a JS file.</p>

        
          <div class='highlight'><pre>      <span class="hljs-keyword">const</span> contentType = response.headers.get(<span class="hljs-string">'content-type'</span>);
      <span class="hljs-keyword">if</span> (
        response.status === <span class="hljs-number">404</span> ||
        (contentType != <span class="hljs-literal">null</span> &amp;&amp; contentType.indexOf(<span class="hljs-string">'javascript'</span>) === <span class="hljs-number">-1</span>)
      ) {</pre></div>
        
      
        
        <p>No service worker found. Probably a different app. Reload the page.</p>

        
          <div class='highlight'><pre>        navigator.serviceWorker.ready.then(<span class="hljs-function"><span class="hljs-params">registration</span> =&gt;</span> {
          registration.unregister().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            <span class="hljs-built_in">window</span>.location.reload();
          });
        });
      } <span class="hljs-keyword">else</span> {</pre></div>
        
      
        
        <p>Service worker found. Proceed as normal.</p>

        
          <div class='highlight'><pre>        registerValidSW(swUrl, config);
      }
    })
    .catch(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      <span class="hljs-built_in">console</span>.log(
        <span class="hljs-string">'No internet connection found. App is running in offline mode.'</span>
      );
    });
}

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unregister</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-string">'serviceWorker'</span> <span class="hljs-keyword">in</span> navigator) {
    navigator.serviceWorker.ready.then(<span class="hljs-function"><span class="hljs-params">registration</span> =&gt;</span> {
      registration.unregister();
    });
  }
}</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
